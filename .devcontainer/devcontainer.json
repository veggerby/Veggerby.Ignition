// For format details, see https://aka.ms/devcontainer.json. For config options, see the
// README at: https://github.com/devcontainers/templates/tree/main/src/dotnet
{
	"name": "Veggerby.Ignition",
    "workspaceFolder": "/workspaces/${localWorkspaceFolderBasename}",
    "image": "mcr.microsoft.com/devcontainers/base:trixie",

	"forwardPorts": [
    ],

	"portsAttributes": {
    },

	"features": {
		"ghcr.io/devcontainers/features/common-utils:2": {
			"installZsh": true,
			"installOhMyZsh": true,
			"upgradePackages": true,
			"username": "automatic",
			"userUid": "automatic",
			"userGid": "automatic"
		},
		"ghcr.io/devcontainers/features/git:1": {
			"ppa": true,
			"version": "os-provided"
		},
        "ghcr.io/devcontainers/features/dotnet:2": {
            "version": "10.0"
        },
		"ghcr.io/devcontainers/features/node:1": {
            "version": "lts"
        },
        "ghcr.io/devcontainers-extra/features/apt-get-packages:1": {
            "packages": "bash-completion xdg-utils pass sshpass build-essential python3 python3-pip curl wget netcat-traditional iputils-ping dnsutils git-lfs sqlite3 vim less"
        },
        "ghcr.io/eitsupi/devcontainer-features/jq-likes:2": {
            "jq": "latest",
            "yq": "latest"
        },
        "ghcr.io/devcontainers/features/github-cli:1": {},
        "ghcr.io/devcontainers/features/docker-outside-of-docker": {
            "moby": false            
        }
	},

	"customizations": {
		"vscode": {
			"extensions": [
				"ms-dotnettools.csdevkit",
				"heaths.vscode-guid",
				"DavidAnson.vscode-markdownlint",
				"EditorConfig.EditorConfig",
				"streetsidesoftware.code-spell-checker",
				"nuke.support",
				"dbaeumer.vscode-eslint",
				"GitHub.copilot",
				"GitHub.copilot-chat",
				"redhat.vscode-yaml",
				"github.vscode-github-actions",
				"bierner.markdown-mermaid",
				"humao.rest-client",
				"GitHub.vscode-pull-request-github"
			]
		}
	},

    "mounts": [
        "source=${localEnv:HOME}${localEnv:USERPROFILE}/.ssh,target=/home/vscode/.ssh,type=bind,consistency=cached,readOnly=true",
        "source=${localEnv:HOME}${localEnv:USERPROFILE}/.codex,target=/home/vscode/.codex,type=bind,consistency=cached"
    ],

    "remoteEnv": {
        "LOCAL_WORKSPACE_FOLDER": "${localWorkspaceFolder}",
        "PNPM_HOME": "/home/vscode/.local/share/pnpm",
        "PATH": "/home/vscode/.local/share/pnpm:${containerEnv:PATH}",
        "TESTCONTAINERS_HOST_OVERRIDE": "host.docker.internal"
    },

	"postCreateCommand": {
        "install-global-packages": "bash ${containerWorkspaceFolder}/.devcontainer/scripts/install-global-packages.sh",
        "install-script": "bash ${containerWorkspaceFolder}/.devcontainer/scripts/post_create.sh"
    }
}
